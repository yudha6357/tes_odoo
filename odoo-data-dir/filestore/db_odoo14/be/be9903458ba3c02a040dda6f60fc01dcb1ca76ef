
/* /web/static/tests/helpers/test_utils_file.js defined in bundle 'web.assets_tests' */
odoo.define('web.test_utils_file',function(){"use strict";function _createFakeDataTransfer(files){return{dropEffect:'all',effectAllowed:'all',files,getData:function(){return files;},items:[],types:['Files'],};}
function createFile(data){return new Promise(function(resolve,reject){var requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem;if(!requestFileSystem){throw new Error('FileSystem API is not supported');}
requestFileSystem(window.TEMPORARY,1024*1024,function(fileSystem){fileSystem.root.getFile(data.name,{create:true},function(fileEntry){fileEntry.createWriter(function(fileWriter){fileWriter.onwriteend=function(e){fileSystem.root.getFile(data.name,{},function(fileEntry){fileEntry.file(function(file){resolve(file);});});};fileWriter.write(new Blob([data.content],{type:data.contentType}));});});});});}
function dragoverFile($el,file){var ev=new Event('dragover',{bubbles:true});Object.defineProperty(ev,'dataTransfer',{value:_createFakeDataTransfer(file),});$el[0].dispatchEvent(ev);}
function dropFile($el,file){var ev=new Event('drop',{bubbles:true,});Object.defineProperty(ev,'dataTransfer',{value:_createFakeDataTransfer([file]),});$el[0].dispatchEvent(ev);}
function dropFiles($el,files){var ev=new Event('drop',{bubbles:true,});Object.defineProperty(ev,'dataTransfer',{value:_createFakeDataTransfer(files),});$el[0].dispatchEvent(ev);}
function inputFiles(el,files){const dataTransfer=new window.DataTransfer();for(const file of files){dataTransfer.items.add(file);}
el.files=dataTransfer.files;const versionRaw=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);const chromeVersion=versionRaw?parseInt(versionRaw[2],10):false;if(!chromeVersion||chromeVersion>=73){el.dispatchEvent(new Event('change'));}}
return{createFile:createFile,dragoverFile:dragoverFile,dropFile:dropFile,dropFiles,inputFiles,};});;

/* /auth_totp/static/tests/totp_flow.js defined in bundle 'web.assets_tests' */
odoo.define('auth_totp.tours',function(require){"use strict";const tour=require('web_tour.tour');const ajax=require('web.ajax');function openRoot(){return[{content:"return to client root to avoid race condition",trigger:'body',run(){$('body').addClass('wait');window.location='/web';}},{content:"wait for client reload",trigger:'body:not(.wait)',run(){}}];}
function openUserProfileAtSecurityTab(){return[{content:'Open user account menu',trigger:'.o_user_menu .oe_topbar_name',run:'click',},{content:"Open preferences / profile screen",trigger:'[data-menu=settings]',run:'click',},{content:"Switch to security tab",trigger:'a[role=tab]:contains("Account Security")',run:'click',}];}
tour.register('totp_tour_setup',{test:true,url:'/web'},[...openUserProfileAtSecurityTab(),{content:"Open totp wizard",trigger:'button[name=totp_enable_wizard]',},{content:"Check that we have to enter enhanced security mode",trigger:'div:contains("confirm your password")',run:()=>{},},{content:"Input password",trigger:'[name=password]',run:'text demo',},{content:"Confirm",trigger:"button:contains(Confirm Password)",},{content:"Check the wizard has opened",trigger:'div:contains("Scan the image below")',run:()=>{}},{content:"Get secret from collapsed div",trigger:'a:contains("show the code")',run(helpers){const secret=this.$anchor.closest('div').find('code').text();ajax.jsonRpc('/totphook','call',{secret}).then((token)=>{helpers._text(helpers._get_action_values('input[name=code]'),token);helpers._click(helpers._get_action_values('button.btn-primary:contains(Enable)'));$('body').addClass('got-token')});}},{content:'wait for rpc',trigger:'body.got-token',run(){}},...openRoot(),...openUserProfileAtSecurityTab(),{content:"Check that the button has changed",trigger:'button:contains(Disable two-factor authentication)',run:()=>{}}]);tour.register('totp_login_enabled',{test:true,url:'/'},[{content:"check that we're on the login page or go to it",trigger:'input#login, a:contains(Sign in)'},{content:"input login",trigger:'input#login',run:'text demo',},{content:'input password',trigger:'input#password',run:'text demo',},{content:"click da button",trigger:'button:contains("Log in")',},{content:"expect totp screen",trigger:'label:contains(Authentication Code)',},{content:"input code",trigger:'input[name=totp_token]',run(helpers){ajax.jsonRpc('/totphook','call',{}).then((token)=>{helpers._text(helpers._get_action_values(),token);helpers._click(helpers._get_action_values('button:contains("Verify")'));});}},{content:"check we're logged in",trigger:".o_user_menu .oe_topbar_name",run:()=>{}}]);tour.register('totp_login_device',{test:true,url:'/'},[{content:"check that we're on the login page or go to it",trigger:'input#login, a:contains(Sign in)'},{content:"input login",trigger:'input#login',run:'text demo',},{content:'input password',trigger:'input#password',run:'text demo',},{content:"click da button",trigger:'button:contains("Log in")',},{content:"expect totp screen",trigger:'label:contains(Authentication Code)',},{content:"check remember device box",trigger:'label[for=switch-remember]',},{content:"input code",trigger:'input[name=totp_token]',run(helpers){ajax.jsonRpc('/totphook','call',{}).then((token)=>{helpers._text(helpers._get_action_values(),token);helpers._click(helpers._get_action_values('button:contains("Verify")'));});}},{content:"check we're logged in",trigger:".o_user_menu .oe_topbar_name",run:()=>{}},{content:"click on the user",trigger:'li[class=o_user_menu] > a',},{content:"click the Log out button",trigger:'a[data-menu=logout]',},{content:"check that we're back on the login page or go to it",trigger:'input#login, a:contains(Log in)'},{content:"input login again",trigger:'input#login',run:'text demo',},{content:'input password again',trigger:'input#password',run:'text demo',},{content:"click da button again",trigger:'button:contains("Log in")',},{content:"check we're logged in without 2FA",trigger:".o_user_menu .oe_topbar_name",run:()=>{}},...openUserProfileAtSecurityTab(),{content:"Open totp wizard",trigger:'button[name=totp_disable]',},{content:"Check that we have to enter enhanced security mode",trigger:'div:contains("confirm your password")',run:()=>{},},{content:"Input password",trigger:'[name=password]',run:'text demo',},{content:"Confirm",trigger:"button:contains(Confirm Password)",},...openRoot(),...openUserProfileAtSecurityTab(),{content:"Check that the button has changed",trigger:'button:contains(Enable two-factor authentication)',run:()=>{}}]);tour.register('totp_login_disabled',{test:true,url:'/'},[{content:"check that we're on the login page or go to it",trigger:'input#login, a:contains(Sign in)'},{content:"input login",trigger:'input#login',run:'text demo',},{content:'input password',trigger:'input#password',run:'text demo',},{content:"click da button",trigger:'button:contains("Log in")',},...openUserProfileAtSecurityTab(),]);const columns={};tour.register('totp_admin_disables',{test:true,url:'/web'},[tour.stepUtils.showAppsMenuItem(),{content:'Go to settings',trigger:'[data-menu-xmlid="base.menu_administration"]'},{content:'Wait for page',trigger:'.o_menu_brand:contains("Settings")',run:()=>{}},{content:"Open Users menu",trigger:'[data-menu-xmlid="base.menu_users"]'},{content:"Open Users view",trigger:'[data-menu-xmlid="base.menu_action_res_users"]',run:function(helpers){const $crumb=$('.breadcrumb');if($crumb.text().indexOf('Users')===-1){helpers.click();}else{helpers.click($('[data-menu-xmlid="base.menu_users"]'));}}},{content:"Find Demo User",trigger:'td.o_data_cell:contains("demo")',run:function(helpers){const $titles=this.$anchor.closest('table').find('tr:first th');for(let i=0;i<$titles.length;++i){columns[$titles[i].getAttribute('data-name')]=i;}
const $row=this.$anchor.closest('tr');const sel=$row.find('.o_list_record_selector input[type=checkbox]');const totp=$row[0].children[columns['totp_enabled']].querySelector('input');if(totp.checked){helpers.click(sel);}}},{content:"Open Actions menu",trigger:'button.o_dropdown_toggler_btn:contains("Action")'},{content:"Select totp remover",trigger:'a.dropdown-item:contains(Disable TOTP on users)'},{content:"Check that we have to enter enhanced security mode",trigger:'div:contains("confirm your password")',run:()=>{},},{content:"Input password",trigger:'[name=password]',run:'text admin',},{content:"Confirm",trigger:"button:contains(Confirm Password)",},{content:"check that demo user has been de-totp'd",trigger:"td.o_data_cell:contains(demo)",run:function(){const totpcell=this.$anchor.closest('tr')[0].children[columns['totp_enabled']];if(totpcell.querySelector('input').checked){throw new Error("totp should have been disabled on demo user");}}}])});